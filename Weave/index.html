<!doctype html>
<html>
  <head>
    <script src="https://cdn.socket.io/socket.io-3.0.0.js"></script>
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="notesTempFile.js"></script>
    <link rel="stylesheet" href="stylesheet.css">
  </head>
  <body>
    <script defer type="module" src="renderer.js"></script>

    <!-- Your original HTML -->
    <div class="container">
      <div class="map-options">
        <button id="drawButton" class="verticalButtons">Draw</button>
        <button id="drawButtonClear" class="verticalButtons">Clear Drawings</button>
        <div class="marker-container">
          <button id="addRemoveMarkers" class="verticalButtons">Add/Remove Marker</button>
          <button id="circleButton" class="markerButtons">Circle</button>
          <button id="squareButton" class="markerButtons">Square</button>
          <button id="coneButton" class="markerButtons">Cone</button>
          <button id="deleteButton" class="markerButtons">Delete</button>
        </div>
        <button class="verticalButtons">Add Grid</button>
        <button id="importMapButton" class="verticalButtons">Import Map</button>
        <button class="verticalButtons">Import Token</button>
      </div>
      <div class="top-right-container">
        <button id="characterSheetButton">Character Sheet</button>
        <button id="notesButton">Notes</button>
        <div id="notes">
          <div id="notesHeader">Notes</div>
          <p>Move</p>
          <p>this</p>
          <p>DIV</p>
        </div>
        <button id="settingsButton">Settings</button>
      </div>
    </div>
    <div class="dice-options">
      <button class="dice-buttons">D4</button>
      <button class="dice-buttons">D6</button>
      <button class="dice-buttons">D8</button>
      <button class="dice-buttons">D10</button>
      <button class="dice-buttons">D12</button>
      <button class="dice-buttons">D20</button>
      <button class="dice-buttons">+</button>
    </div>

    <div class="chat-container">
        <div class="chat-header">Chat</div>
        <div class="chat-messages">
            <div class="chat-message">Welcome to the chat!</div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" placeholder="Type a message...">
            <button class="chat-send-btn">Send</button>
        </div>
    </div>

    <script>
        console.log('Script loaded');
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded');

            const socket = io('http://localhost:3000');
            const chatMessages = document.querySelector('.chat-messages');
            const chatInput = document.querySelector('.chat-input');
            const chatSendBtn = document.querySelector('.chat-send-btn');

            if (!chatMessages || !chatInput || !chatSendBtn) {
                console.error('Chat elements missing');
                return;
            }
            console.log('Chat elements found');

            socket.on('connect', () => {
                console.log('Socket.IO connected');
                addMessage('System: Connected');
            });

            socket.on('connect_error', (error) => {
                console.error('Socket.IO error:', error);
            });

            function addMessage(message) {
                console.log('Adding message:', message);
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.textContent = message;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            chatSendBtn.addEventListener('click', () => {
                console.log('Send clicked');
                sendMessage();
            });

            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    console.log('Enter pressed');
                    sendMessage();
                }
            });

            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    console.log('Sending:', message);
                    socket.emit('chatMessage', 'You: ' + message);
                    addMessage('You: ' + message);
                    chatInput.value = '';
                }
            }

            socket.on('chatMessage', (message) => {
                console.log('Received:', message);
                addMessage(message);
            });

            setTimeout(() => {
                addMessage('Test: Loaded successfully');
            }, 2000);
        });
    </script>
</body>
</html>
